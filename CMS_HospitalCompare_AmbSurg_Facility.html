<html>

<head>
<!--Here is where you will be able to change the title of the connector-->
    <title>My First Connector</title>
<!--Here is where all of the libraries which provide the code with objects to use -->
<meta http-equiv="Cache-Control" content="no-store" />
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js" type="text/javascript"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" crossorigin="anonymous"></script>
    <script src="https://connectors.tableau.com/libs/tableauwdc-2.0.latest.js" type="text/javascript"></script>

<!--Here is where we will do the most work-->
    <script type="text/javascript">

//add makeConnector statement here
(function () {


    var myConnector = tableau.makeConnector();

//Add getSchema statement here
    myConnector.getSchema = function (schemaCallback) {
var cols = [
{ id : "asc_name", alias : "asc_name", dataType : tableau.dataTypeEnum.string },
{ id : "provider_id", alias : "provider_id", dataType : tableau.dataTypeEnum.string },
{ id : "npi", alias : "npi", dataType : tableau.dataTypeEnum.string },
{ id : "city", alias : "city", dataType : tableau.dataTypeEnum.string },
{ id : "state", alias : "state", dataType : tableau.dataTypeEnum.string },
{ id : "zip_code", alias : "zip_code", dataType : tableau.dataTypeEnum.string },
{ id : "year", alias : "year", dataType : tableau.dataTypeEnum.string },
{ id : "asc1_measure_rate", alias : "asc1_measure_rate", dataType : tableau.dataTypeEnum.string },
{ id : "asc1_footnote", alias : "asc1_footnote", dataType : tableau.dataTypeEnum.string },
{ id : "asc2_measure_rate", alias : "asc2_measure_rate", dataType : tableau.dataTypeEnum.string },
{ id : "asc2_footnote", alias : "asc2_footnote", dataType : tableau.dataTypeEnum.string },
{ id : "asc3_measure_rate", alias : "asc3_measure_rate", dataType : tableau.dataTypeEnum.string },
{ id : "asc3_footnote", alias : "asc3_footnote", dataType : tableau.dataTypeEnum.string },
{ id : "asc4_measure_rate", alias : "asc4_measure_rate", dataType : tableau.dataTypeEnum.string },
{ id : "asc4_footnote", alias : "asc4_footnote", dataType : tableau.dataTypeEnum.string },
{ id : "asc5_measure_rate", alias : "asc5_measure_rate", dataType : tableau.dataTypeEnum.string },
{ id : "asc5_footnote", alias : "asc5_footnote", dataType : tableau.dataTypeEnum.string },
{ id : "asc_1_5_encounter_start_date", alias : "asc_1_5_encounter_start_date", dataType : tableau.dataTypeEnum.string },
{ id : "asc_1_5_encounter_end_date", alias : "asc_1_5_encounter_end_date", dataType : tableau.dataTypeEnum.string },
{ id : "asc6_sschecklist", alias : "asc6_sschecklist", dataType : tableau.dataTypeEnum.string },
{ id : "asc_7_volume", alias : "asc_7_volume", dataType : tableau.dataTypeEnum.string },
{ id : "asc7_gastrointestinal", alias : "asc7_gastrointestinal", dataType : tableau.dataTypeEnum.string },
{ id : "asc7_eye", alias : "asc7_eye", dataType : tableau.dataTypeEnum.string },
{ id : "asc7_musculoskeletal", alias : "asc7_musculoskeletal", dataType : tableau.dataTypeEnum.string },
{ id : "asc7_skin", alias : "asc7_skin", dataType : tableau.dataTypeEnum.string },
{ id : "asc7_genitourinary", alias : "asc7_genitourinary", dataType : tableau.dataTypeEnum.string },
{ id : "asc_7_multi_system", alias : "asc_7_multi_system", dataType : tableau.dataTypeEnum.string },
{ id : "asc7_nervous_system", alias : "asc7_nervous_system", dataType : tableau.dataTypeEnum.string },
{ id : "asc_7_respiratory", alias : "asc_7_respiratory", dataType : tableau.dataTypeEnum.string },
{ id : "asc7_footnote", alias : "asc7_footnote", dataType : tableau.dataTypeEnum.string },
{ id : "asc_6_7_encounter_start_date", alias : "asc_6_7_encounter_start_date", dataType : tableau.dataTypeEnum.string },
{ id : "asc_6_7_encounter_end_date", alias : "asc_6_7_encounter_end_date", dataType : tableau.dataTypeEnum.string },
{ id : "asc_8_rate", alias : "asc_8_rate", dataType : tableau.dataTypeEnum.string },
{ id : "asc8_footnote", alias : "asc8_footnote", dataType : tableau.dataTypeEnum.string },
{ id : "asc_8_encounter_date", alias : "asc_8_encounter_date", dataType : tableau.dataTypeEnum.string },
{ id : "asc_9_rate", alias : "asc_9_rate", dataType : tableau.dataTypeEnum.string },
{ id : "asc9_footnote", alias : "asc9_footnote", dataType : tableau.dataTypeEnum.string },
{ id : "asc_10_rate", alias : "asc_10_rate", dataType : tableau.dataTypeEnum.string },
{ id : "asc10_footnote", alias : "asc10_footnote", dataType : tableau.dataTypeEnum.string },
{ id : "asc_9_10_encounter_start_date", alias : "asc_9_10_encounter_start_date", dataType : tableau.dataTypeEnum.string },
{ id : "asc_9_10_encounter_end_date", alias : "asc_9_10_encounter_end_date", dataType : tableau.dataTypeEnum.string },
];

var tableInfo = {
id : "CMS_HospitalCompare_AmbSurg_Facility",
alias : "CMS_HospitalCompare_AmbSurg_Facility",
columns : cols
};

schemaCallback([tableInfo]);
    };

//Add getData statement here
    myConnector.getData = function (table, doneCallback) {

$.getJSON('https://data.medicare.gov/resource/r2ps-634m.json', function(resp) {
var feat = resp,
tableData = [];
console.log(resp);


for (var i = 0, len = feat.length; i < len; i++) {
tableData.push({
"asc_name": feat[i].asc_name,
"provider_id": feat[i].provider_id,
"npi": feat[i].npi,
"city": feat[i].city,
"state": feat[i].state,
"zip_code": feat[i].zip_code,
"year": feat[i].year,
"asc1_measure_rate": feat[i].asc1_measure_rate,
"asc1_footnote": feat[i].asc1_footnote,
"asc2_measure_rate": feat[i].asc2_measure_rate,
"asc2_footnote": feat[i].asc2_footnote,
"asc3_measure_rate": feat[i].asc3_measure_rate,
"asc3_footnote": feat[i].asc3_footnote,
"asc4_measure_rate": feat[i].asc4_measure_rate,
"asc4_footnote": feat[i].asc4_footnote,
"asc5_measure_rate": feat[i].asc5_measure_rate,
"asc5_footnote": feat[i].asc5_footnote,
"asc_1_5_encounter_start_date": feat[i].asc_1_5_encounter_start_date,
"asc_1_5_encounter_end_date": feat[i].asc_1_5_encounter_end_date,
"asc6_sschecklist": feat[i].asc6_sschecklist,
"asc6_footnote": feat[i].asc6_footnote,
"asc_7_volume": feat[i].asc_7_volume,
"asc7_gastrointestinal": feat[i].asc7_gastrointestinal,
"asc7_eye": feat[i].asc7_eye,
"asc7_musculoskeletal": feat[i].asc7_musculoskeletal,
"asc7_skin": feat[i].asc7_skin,
"asc7_genitourinary": feat[i].asc7_genitourinary,
"asc_7_multi_system": feat[i].asc_7_multi_system,
"asc7_nervous_system": feat[i].asc7_nervous_system,
"asc_7_respiratory": feat[i].asc_7_respiratory,
"asc7_footnote": feat[i].asc7_footnote,
"asc_6_7_encounter_start_date": feat[i].asc_6_7_encounter_start_date,
"asc_6_7_encounter_end_date": feat[i].asc_6_7_encounter_end_date,
"asc_8_rate": feat[i].asc_8_rate,
"asc8_footnote": feat[i].asc8_footnote,
"asc_8_encounter_date": feat[i].asc_8_encounter_date,
"asc_9_rate": feat[i].asc_9_rate,
"asc9_footnote": feat[i].asc9_footnote,
"asc_10_rate": feat[i].asc_10_rate,
"asc10_footnote": feat[i].asc10_footnote,
"asc_9_10_encounter_start_date": feat[i].asc_9_10_encounter_start_date,
"asc_9_10_encounter_end_date": feat[i].asc_9_10_encounter_end_date,
});
}

table.appendRows(tableData);
doneCallback();
});

    };

//Add event listener here
tableau.registerConnector(myConnector);

$(document).ready(function () {
$("#submitButton").click(function () {

tableau.connectionName = "CMS HospitalCompare - Ambulatory Surgery - Facility";
tableau.submit();

});
});
})();


</script>
</head>

<body>
    <div class="container container-table">
        <div class="row vertical-center-row">
            <div class="text-center col-md-4 col-md-offset-4">
              <!--Change Get Data to Get Google Fiber Data-->
                <button type="button" id="submitButton" class="btn btn-success" style="margin: 10px;">Get Data</button>
            </div>
        </div>
    </div>
</body>

</html>
